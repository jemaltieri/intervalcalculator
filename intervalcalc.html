<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">


<head>

<title>Interval Calculator</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Style-Type" content="text/css">



<script language="JavaScript">
function multbyratio() {
	var startFreq = parseFloat(document.getElementById('inputFreq').value);
	var num = parseFloat(document.getElementById('numerator').value);
	var den = parseFloat(document.getElementById('denominator').value);
	var result = startFreq*num/den;
	result = Math.round(result*100)/100;
	noteNameResult(result);
	document.getElementById('resultHz').innerHTML = result + " Hz";
}

function multbyet(startFreq) {
	var startFreq = parseFloat(document.getElementById('inputFreq').value);
	var steps = parseFloat(document.getElementById('steps').value);
	var stepsper = parseFloat(document.getElementById('stepsperoctave').value);
	var result = startFreq * Math.pow(2,steps/stepsper);
	result = Math.round(result*100)/100;
	noteNameResult(result);
	document.getElementById('resultHz').innerHTML = result + "Hz";
}

function switchTransform(selectObj) {
	var chosenoption=selectObj.options[selectObj.selectedIndex].value;
	if (chosenoption == "JI") {
		document.getElementById('transformspan').innerHTML = "Ratio: <input type=\"text\" size=\"3\" maxlength=\"3\" id=\"numerator\" value=\"1\" onchange=\"multbyratio()\"  /> / <input type=\"text\" size=\"3\" maxlength=\"3\" id=\"denominator\" value=\"1\" onchange=\"multbyratio()\"  /><br />";
	} else if (chosenoption == "ET") {	
		document.getElementById('transformspan').innerHTML = "<input type=\"text\" size=\"3\" maxlength=\"3\" id=\"steps\" value=\"0\" onchange=\"multbyet()\"  /> steps out of <input type=\"text\" size=\"3\" maxlength=\"3\" id=\"stepsperoctave\" value=\"12\" onchange=\"multbyet()\"  /> steps per octave <br />";
	}
	updateResult();
}

function note2midi(noteName, accidental, octave) {
	var result;
	switch(noteName) {
		case 'C': result = 0; break;
		case 'D': result = 2; break;
		case 'E': result = 4; break;
		case 'F': result = 5; break;
		case 'G': result = 7; break;
		case 'A': result = 9; break;
		case 'B': result = 11; break;
		default: alert("note2midi: problem with note name");
	}
	switch(accidental) {
		case 'natural': break;
		case 'sharp': result = result+1; break;
		case 'flat': result = result-1; break;
		default: alert("note2midi: problem with accidental");
	}
	result = result + ((parseFloat(octave)+1)*12);
	return result;		
}

function midi2freq(midiNote) {
	return 440. * Math.pow(2, (midiNote-69)/12.);
}

function freq2midi(freq) {
	// (log (base 2^(1/12)) freq/440.) + 69
	return Math.log(freq/440.)/Math.log(Math.pow(2,1./12.)) + 69.
}

function midi2note(midiNote) {
}

function selectValueSet(selectId, val) {
	var selectObject = document.getElementById(selectId);
	for (index = 0; index < selectObject.length; index++) {
		if (selectObject[index].value == val) {
			selectObject.selectedIndex = index;
			break;
		}
   } 
}

function selectValueGet(selectId) {
	var e = document.getElementById(selectId);
	return e.options[e.selectedIndex].value;
}

function noteNameResult(freq) {
	var midiNum = freq2midi(freq);
	var roundedMidiNum = Math.round(midiNum);
	var cents = Math.round(((midiNum-roundedMidiNum)*10000)/100);
	var octave = ((roundedMidiNum - (roundedMidiNum % 12)) / 12) - 1;
	midiNum = roundedMidiNum % 12;
	var noteNames=["C","C","D","D","E","F","F","G","G","A","A","B"];
	var accidentals=["♮","♯","♮","♯","♮","♮","♯","♮","♯","♮","♯","♮"];
	document.getElementById("result12tet").innerHTML = noteNames[midiNum] + accidentals[midiNum] + octave + " " + printCents(cents) + "¢";
}

function updateResult() {
	var calcType = selectValueGet('calcType');
	switch(calcType) {
		case 'JI': multbyratio(); break;
		case 'ET': multbyet(); break;
		default: alert("updateResult: what kind of calculation?");
	}
}


function printCents(n) {
	return (n > 0) ? "+" + n : n; 
}

function changedFreq() {
	var midiNum = freq2midi(parseFloat(document.getElementById("inputFreq").value));
	var roundedMidiNum = Math.round(midiNum);
	var cents = Math.round(((midiNum-roundedMidiNum)*10000)/100);	
	document.getElementById("inputCents").value = printCents(cents);
	var octave = ((roundedMidiNum - (roundedMidiNum % 12)) / 12) - 1;
	midiNum = roundedMidiNum % 12;
	var noteNames=["C","C","D","D","E","F","F","G","G","A","A","B"];
	var accidentals=["natural","sharp","natural","sharp","natural","natural","sharp","natural","sharp","natural","sharp","natural"];
	selectValueSet("inputNoteName",noteNames[midiNum]);
	selectValueSet("inputAccidental",accidentals[midiNum]);
	selectValueSet("inputOctave",octave+'');
	updateResult();
}

function changedNote() {
	var noteName = selectValueGet("inputNoteName");
	var accidental = selectValueGet("inputAccidental");
	var octave = selectValueGet("inputOctave");
	var centsStr = document.getElementById("inputCents").value;
	if (centsStr == "") {
		centsStr = "0";
	}
	var cents = parseFloat(centsStr);
	document.getElementById("inputFreq").value = midi2freq(note2midi(noteName,accidental,octave)+(cents/100));
	updateResult();
}

</script>

<script src="js/src/audiolet/Audiolet.js"></script>
<script src="js/audiolet_app.js"></script>

<STYLE type="text/css">
   div#left {
   	position: absolute;
   	left: 100px;
   	top: 150px;
		width: 300px;
		height: 300px;
		border: 1px black solid;
		text-align: center;
   }
	div#mid {
		position: absolute;
		left: 400px;
		top: 150px;
		width: 300px;
		height: 300px;
		border: 1px black solid;
		text-align: center;
	}
	div#right {
		position: absolute;
		left: 700px;
		top: 150px;
		width: 300px;
		height: 300px;
		border: 1px black solid;
		text-align: center;
	}
	#calcbutton {
		position: absolute;
		left:400px;
		top: 365px;
	}
	.staffnotation {
		position: relative;
		margin-left: 15%;
		margin-top: 10px;
		margin-bottom: 10px;
		width: 70%;
		height: 150px;
		border: 1px black dotted;
	}

</STYLE>

</head>

<body>
<h1>interval calculator 2.0 ALPHA</h1>
<p>by <a href="http://tweeg.net">jim altieri</a><br />
extremely rough draft - please see <a href="/">development blog</a> for details
<div id="left">
<h2>Starting Pitch</h2>
<div class="staffnotation">
Staff notation goes here
</div>
<select id="inputNoteName" onchange="changedNote()">
	<option value="C">C</option>
	<option value="D">D</option>
	<option value="E">E</option>
	<option value="F">F</option>
	<option value="G">G</option>
	<option value="A">A</option>
	<option value="B">B</option>
</select>
<select id="inputAccidental" onchange="changedNote()">
	<option value="natural">♮</option>
	<option value="sharp">♯</option>
	<option value="flat">♭</option>
</select>
<select id="inputOctave" onchange="changedNote()">
	<option value="0">0</option>
	<option value="1">1</option>
	<option value="2">2</option>
	<option value="3">3</option>
	<option value="4" selected="selected">4</option>
	<option value="5">5</option>
	<option value="6">6</option>
	<option value="7">7</option>
	<option value="8">8</option>
	<option value="9">9</option>
</select>
<input type="text" size="2" maxlength="2" id="inputCents" onchange="changedNote()" /> cents<br />
<input type="text" size="3" maxlength="6" id="inputFreq" onchange="changedFreq()" value="440" /> Hz<br />
<input type="checkbox" id="synth1" onchange="toggleSynth()" />

</div>
<div id="mid">
<h2>Transformation</h2>
Type of transformation:
<select id="calcType" onChange="switchTransform(this)">
	<option value="JI" selected="selected">JI</option>
	<option value="ET">ET</option>
</select><br />
<span id="transformspan">
Ratio: <input type="text" size="2" maxlength="4" id="numerator" value="1" onchange="multbyratio()" /> / 
<input type="text" size="2" maxlength="4" id="denominator" value="1" onchange="multbyratio()" /><br />
</span>
</div>
<div id="right">
<h2>Resulting Pitch</h2>
<div class="staffnotation">
Staff notation goes here
</div>
<div id="result12tet">
</div>
<div id="resultHz">
</div>
</div>
</div>




</body>

</html>