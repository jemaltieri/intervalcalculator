<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">


<head>

<title>Interval Calculator</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Style-Type" content="text/css">


<script language="JavaScript">
function multbyratio(theForm) {
	var startNote = theForm.startfreq.value;
	var numerator = theForm.num.value;
	var denominator = theForm.den.value;
	var result = parseFloat(startNote) * parseFloat(numerator) / parseFloat(denominator);
	result = Math.round(result*100)/100;
	document.getElementById('resultHz').innerHTML = result + "Hz";
}

function multbyet(theForm) {
	//alert("multbyet was called!");
	var startNote = theForm.startfreq.value;
	var numerator = theForm.num.value;
	var denominator = theForm.den.value;
	var result = parseFloat(startNote) * Math.pow(2,(parseFloat(numerator)/parseFloat(denominator)));
	//alert("got answer "+result);	
	result = Math.round(result*100)/100;
	document.getElementById('resultHz').innerHTML = result + "Hz";
}

function switchTransform(selectObj) {
	//alert("switchTransform called");
	var chosenoption=selectObj.options[selectObj.selectedIndex].value;
	button_element=document.getElementById('calcbutton');
	//alert(button_element);
	//alert(chosenoption);
	if (chosenoption == "JI") {
		//alert("JI chosen");
		document.getElementById('transformform').innerHTML = "Ratio: <input type=\"text\" size=\"3\" maxlength=\"3\" name=\"num\" /> / <input type=\"text\" size=\"3\" maxlength=\"3\" name=\"den\" /><br />";
		button_element.setAttribute('onclick','multbyratio(this.form);'); // for FF
    	button_element.onclick = function() {multbyratio(this.form);}; // for IE
	} else if (chosenoption == "ET") {
		//alert("ET chosen");		
		document.getElementById('transformform').innerHTML = "<input type=\"text\" size=\"3\" maxlength=\"3\" name=\"num\" /> steps out of <input type=\"text\" size=\"3\" maxlength=\"3\" name=\"den\" /> steps per octave <br />";
		button_element.setAttribute('onclick','multbyet(this.form);'); // for FF
    	button_element.onclick = function() {multbyet(this.form);}; // for IE
	}
}

function note2midi(noteName, accidental, octave) {
	var result;
	switch(noteName) {
		case 'C': result = 0; break;
		case 'D': result = 2; break;
		case 'E': result = 4; break;
		case 'F': result = 5; break;
		case 'G': result = 7; break;
		case 'A': result = 9; break;
		case 'B': result = 11; break;
		default: alert("note2midi: problem with note name");
	}
	switch(accidental) {
		case 'natural': break;
		case 'sharp': result = result+1; break;
		case 'flat': result = result-1; break;
		default: alert("note2midi: problem with accidental");
	}
	result = result + ((parseFloat(octave)+1)*12);
	return result;		
}

function midi2freq(midiNote) {
	return 440. * Math.pow(2, (midiNote-69)/12.);
}

function freq2midi(freq) {
	// (log (base 2^(1/12)) freq/440.) + 69
	return Math.log(freq/440.)/Math.log(Math.pow(2,1./12.)) + 69.
}


</script>

<STYLE type="text/css">
   div#left {
   	position: absolute;
   	left: 100px;
   	top: 50px;
		width: 300px;
		height: 300px;
		border: 1px black solid;
		text-align: center;
   }
	div#mid {
		position: absolute;
		left: 400px;
		top: 50px;
		width: 300px;
		height: 300px;
		border: 1px black solid;
		text-align: center;
	}
	div#right {
		position: absolute;
		left: 700px;
		top: 50px;
		width: 300px;
		height: 300px;
		border: 1px black solid;
		text-align: center;
	}
	.staffnotation {
		position: relative;
		margin-left: 15%;
		margin-top: 10px;
		margin-bottom: 10px;
		width: 70%;
		height: 150px;
		border: 1px black dotted;
	}

</STYLE>

</head>

<body>
<div id="left">
<h2>Starting Pitch</h2>
<div class="staffnotation">
Staff notation goes here
</div>
<select>
	<option value="C">C</option>
	<option value="D">D</option>
	<option value="E">E</option>
	<option value="F">F</option>
	<option value="G">G</option>
	<option value="A">A</option>
	<option value="B">B</option>
</select>
<select>
	<option value="natural">♮</option>
	<option value="sharp">♯</option>
	<option value="flat">♭</option>
</select>
<select>
	<option value="0">0</option>
	<option value="1">1</option>
	<option value="2">2</option>
	<option value="3">3</option>
	<option value="4" selected="selected">4</option>
	<option value="6">5</option>
	<option value="7">7</option>
	<option value="8">8</option>
	<option value="9">9</option>
</select>
<input type="text" size="2" maxlength="2" name="cents" /> cents<br />
<input type="text" size="3" maxlength="6" name="startfreq" /> Hz
</div>
<div id="mid">
<h2>Transformation</h2>
Type of transformation:
<select id="transType" onChange="switchTransform(this)">
	<option value="JI" selected="selected">JI</option>
	<option value="ET">ET</option>
</select>
<div id="transformform">
Ratio: <input type="text" size="2" maxlength="4" name="num" /> / 
<input type="text" size="2" maxlength="4" name="den" /><br />
</div>
</div>
<div id="right">
<h2>Resulting Pitch</h2>
<div class="staffnotation">
Staff notation goes here
</div>
<div id="result12tet">
</div>
<div id="resultHz">
</div>
</div>
</div>

</body>

</html>